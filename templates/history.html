<!DOCTYPE html>
<html lang="ru" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Статистика</title>
    <link href="cdn.jsdelivr.net" rel="stylesheet">
    <script src="cdn.jsdelivr.net"></script>
</head>
<body class="bg-dark text-light">
<div class="container py-5">
    <a href="/" class="btn btn-outline-light btn-sm mb-4">← К списку</a>
    <h2 class="fw-bold mb-5 text-center">{{ habit.name }}</h2>

    <div class="row">
        <!-- Гистограмма -->
        <div class="col-md-7 mb-4">
            <div class="card bg-black border-secondary p-4">
                <h5 class="text-muted mb-4">Активность за 7 дней</h5>
                <canvas id="habitChart" height="200"></canvas>
            </div>
        </div>

        <!-- Управление историей -->
        <div class="col-md-5">
            <div class="list-group">
                {% for entry in history %}
                <div class="list-group-item bg-dark text-white border-secondary d-flex justify-content-between align-items-center py-3">
                    <span class="fw-lighter">{{ entry.date.strftime('%d %B') }}</span>
                    <form action="{{ url_for('history_update', habit_id=habit.id, log_date=entry.date) }}" method="POST">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="status" 
                                   onchange="this.form.submit()" {% if entry.status %}checked{% endif %}>
                        </div>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
    const ctx = document.getElementById('habitChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ labels|safe }},
            datasets: [{
                label: 'Выполнено',
                data: {{ values|safe }},
                backgroundColor: '#238636',
                borderRadius: 8,
                barThickness: 30
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true, max: 1, ticks: { display: false }, grid: { display: false } },
                x: { grid: { display: false } }
            },
            plugins: { legend: { display: false } }
        }
    });
</script>
</body>
</html>
