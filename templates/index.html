<!DOCTYPE html>
<html lang="ru" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Habit Tracker 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #39d353;
            --secondary-color: #238636;
            --bg-dark: #0d1117;
            --card-bg: #161b22;
            --border-color: #30363d;
            --text-light: #f0f6fc;
            --text-muted: #8b949e;
        }
        
        body { 
            background-color: var(--bg-dark); 
            color: var(--text-light);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            padding-top: 30px;
            padding-bottom: 50px;
        }
        
        .habit-card { 
            background: linear-gradient(145deg, var(--card-bg), #1c2128);
            border: 1px solid var(--border-color); 
            border-radius: 20px; 
            padding: 25px; 
            margin-bottom: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .habit-card:hover { 
            border-color: var(--primary-color);
            box-shadow: 0 10px 30px rgba(57, 211, 83, 0.15);
            transform: translateY(-3px);
        }
        
        .habit-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
            border-radius: 20px 0 0 20px;
        }
        
        .habit-name { 
            font-size: 1.8rem; 
            font-weight: 600; 
            color: var(--text-light);
            margin-bottom: 5px;
        }
        
        .streak-badge {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 8px 16px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(238, 90, 82, 0.3);
        }
        
        .streak-badge .bi-fire {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .history-dots {
            display: flex;
            gap: 6px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .dot { 
            width: 20px; 
            height: 20px; 
            border-radius: 6px; 
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .dot-done { 
            background-color: var(--primary-color); 
            box-shadow: 0 0 15px rgba(57, 211, 83, 0.5);
        }
        
        .dot-empty { 
            background-color: var(--border-color);
        }
        
        .dot:hover {
            transform: scale(1.3);
            z-index: 1;
        }
        
        .dot[title]:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            margin-bottom: 5px;
            z-index: 1000;
        }
        
        .progress-container {
            margin: 15px 0;
        }
        
        .progress {
            height: 10px;
            background-color: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.5s ease;
        }
        
        .progress-text {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 5px;
            text-align: center;
        }
        
        .toggle-btn {
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-decoration: none;
            display: inline-block;
        }
        
        .toggle-btn.done {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .toggle-btn.not-done {
            background: transparent;
            border-color: var(--border-color);
            color: var(--text-muted);
        }
        
        .toggle-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(57, 211, 83, 0.2);
        }
        
        .stats-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            padding: 8px 0;
        }
        
        .stats-link:hover {
            color: white;
            gap: 12px;
        }
        
        .add-form {
            background: linear-gradient(145deg, var(--card-bg), #1c2128);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 40px;
        }
        
        .form-control {
            background-color: rgba(13, 17, 23, 0.7);
            border: 2px solid var(--border-color);
            color: var(--text-light);
            padding: 15px 20px;
            border-radius: 50px;
            font-size: 1.1rem;
        }
        
        .form-control:focus {
            background-color: rgba(13, 17, 23, 0.9);
            border-color: var(--primary-color);
            color: var(--text-light);
            box-shadow: 0 0 0 0.25rem rgba(57, 211, 83, 0.25);
        }
        
        .btn-add {
            background: linear-gradient(135deg, #1f6feb, #2b7deb);
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .btn-add:hover {
            background: linear-gradient(135deg, #2b7deb, #3d8dee);
            transform: scale(1.02);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .page-title {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            padding-bottom: 20px;
        }
        
        .page-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
        }
        
        .date-info {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        .summary-card {
            background: linear-gradient(145deg, var(--card-bg), #1c2128);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .summary-title {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .day-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-align: center;
            margin-top: 5px;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .history-title {
            font-size: 1rem;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
<div class="container py-4">
    <div class="page-title">
        <h1 class="display-4 fw-bold text-white">üöÄ –¢—Ä–µ–∫–µ—Ä –ü—Ä–∏–≤—ã—á–µ–∫</h1>
        <p class="lead text-muted">–§–æ—Ä–º–∏—Ä—É–π—Ç–µ –ø–æ–ª–µ–∑–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</p>
    </div>
    
    <div class="date-info">
        <i class="bi bi-calendar-check"></i> –°–µ–≥–æ–¥–Ω—è: {{ today.strftime('%d %B %Y') }}
    </div>
    
    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–≤—ã—á–∫–∏ -->
    <div class="add-form shadow-lg">
        <form action="/add" method="POST" class="row g-3 align-items-center">
            <div class="col-lg-10">
                <input type="text" name="name" class="form-control" 
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ø—Ä–∏–≤—ã—á–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –£—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞)" required>
            </div>
            <div class="col-lg-2">
                <button type="submit" class="btn btn-add w-100">
                    <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å
                </button>
            </div>
        </form>
    </div>
    
    <!-- –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    {% if habits %}
    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="summary-card">
                <div class="summary-title">–í—Å–µ–≥–æ –ø—Ä–∏–≤—ã—á–µ–∫</div>
                <div class="summary-value">{{ total_habits }}</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="summary-card">
                <div class="summary-title">–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
                <div class="summary-value">{{ completed_today }}/{{ total_habits }}</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="summary-card">
                <div class="summary-title">–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</div>
                <div class="summary-value">
                    {% if habits %}
                        {{ (habits|map(attribute='progress_percentage')|sum / habits|length)|int }}%
                    {% else %}
                        0%
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–∏–≤—ã—á–µ–∫ -->
    {% if habits %}
        {% for habit in habits %}
        <div class="habit-card shadow-lg">
            <div class="row align-items-center">
                <div class="col-lg-7">
                    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∏ —Å—á–µ—Ç—á–∏–∫ —Å–µ—Ä–∏–∏ -->
                    <div class="d-flex align-items-center flex-wrap gap-3 mb-3">
                        <h3 class="habit-name mb-0">{{ habit.name }}</h3>
                        {% if habit.current_streak > 0 %}
                        <div class="streak-badge">
                            <i class="bi bi-fire"></i> –°–µ—Ä–∏—è: {{ habit.current_streak }} {{ russian_plural_days(habit.current_streak) }}
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ 2 –Ω–µ–¥–µ–ª–∏ -->
                    <div class="progress-container">
                        <div class="d-flex justify-content-between mb-2">
                            <small class="text-muted">–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ 2 –Ω–µ–¥–µ–ª–∏</small>
                            <small class="text-muted">{{ habit.completed_last_14 }}/{{ habit.total_last_14 }} –¥–Ω–µ–π</small>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" style="width: {{ habit.progress_percentage }}%;"></div>
                        </div>
                        <div class="progress-text">
                            {{ habit.progress_percentage }}% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                        </div>
                    </div>
                    
                    <!-- –ò—Å—Ç–æ—Ä–∏—è –∑–∞ 14 –¥–Ω–µ–π -->
                    <div class="history-header">
                        <div class="history-title">–ò—Å—Ç–æ—Ä–∏—è –∑–∞ 14 –¥–Ω–µ–π:</div>
                        <div class="history-title">{{ habit.completed_last_14 }}/14 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                    </div>
                    <div class="history-dots">
                        {% for day_status in habit.two_week_history %}
                            <div class="dot {% if day_status %}dot-done{% else %}dot-empty{% endif %}" 
                                 title="–î–µ–Ω—å {{ loop.index }}: {% if day_status %}‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ{% else %}‚úó –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ{% endif %}">
                            </div>
                        {% endfor %}
                    </div>
                    
                    <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É -->
                    <a href="{{ url_for('history', habit_id=habit.id) }}" class="stats-link">
                        <i class="bi bi-graph-up"></i> –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    </a>
                </div>
                
                <div class="col-lg-5 text-lg-end">
                    <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
                    <a href="{{ url_for('toggle_today', habit_id=habit.id) }}" 
                       class="toggle-btn {% if habit.done_today %}done{% else %}not-done{% endif %}">
                        {% if habit.done_today %}
                            <i class="bi bi-check-circle"></i> –í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è
                        {% else %}
                            <i class="bi bi-circle"></i> –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
                        {% endif %}
                    </a>
                    
                    <!-- –§–æ—Ä–º–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
                    <form action="{{ url_for('delete_habit', habit_id=habit.id) }}" method="POST" class="mt-3">
                        <button type="submit" class="btn btn-sm btn-outline-danger" 
                                onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É ¬´{{ habit.name }}¬ª?')">
                            <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∏–≤—ã—á–µ–∫ -->
        <div class="empty-state">
            <i class="bi bi-calendar-heart"></i>
            <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–∏–≤—ã—á–µ–∫</h3>
            <p class="text-muted">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –ø—Ä–∏–≤—ã—á–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ</p>
        </div>
    {% endif %}
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// –ü—Ä–æ—Å—Ç—ã–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
document.addEventListener('DOMContentLoaded', function() {
    const dots = document.querySelectorAll('.dot');
    dots.forEach(dot => {
        dot.addEventListener('mouseenter', function(e) {
            const title = this.getAttribute('title');
            if (title) {
                const tooltip = document.createElement('div');
                tooltip.className = 'custom-tooltip';
                tooltip.textContent = title;
                tooltip.style.position = 'absolute';
                tooltip.style.background = 'rgba(0, 0, 0, 0.9)';
                tooltip.style.color = 'white';
                tooltip.style.padding = '5px 10px';
                tooltip.style.borderRadius = '5px';
                tooltip.style.fontSize = '12px';
                tooltip.style.zIndex = '1000';
                tooltip.style.top = (e.target.offsetTop - 30) + 'px';
                tooltip.style.left = (e.target.offsetLeft + e.target.offsetWidth/2 - 50) + 'px';
                tooltip.style.width = '100px';
                tooltip.style.textAlign = 'center';
                
                document.body.appendChild(tooltip);
                this._tooltip = tooltip;
            }
        });
        
        dot.addEventListener('mouseleave', function() {
            if (this._tooltip) {
                document.body.removeChild(this._tooltip);
                this._tooltip = null;
            }
        });
    });
});
</script>
</body>
</html>